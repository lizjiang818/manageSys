import * as XLSX from 'xlsx';
import * as path from 'path';

// 根据组织架构图定义的数据
const organizationData: Array<{
  层级: number;
  名称: string;
  类型: string;
  负责人: string;
  父节点: string;
  排序: number;
  人员?: string;
}> = [
  // 顶层：寺管会、监管会
  { 层级: 0, 名称: '寺管会', 类型: 'committee', 负责人: '', 父节点: '', 排序: 1, 人员: '' },
  { 层级: 0, 名称: '监管会', 类型: 'committee', 负责人: '', 父节点: '', 排序: 2, 人员: '' },
  
  // 住持（从寺管会和监管会指向）
  { 层级: 0, 名称: '住持', 类型: 'position', 负责人: '释xxx', 父节点: '', 排序: 3, 人员: '' },
  
  // 住持直接管理的部门（第一层）
  { 层级: 1, 名称: '维那', 类型: 'position', 负责人: '释xx法师', 父节点: '住持', 排序: 1, 人员: '' },
  { 层级: 1, 名称: '监院一', 类型: 'position', 负责人: '释xx法师', 父节点: '住持', 排序: 2, 人员: '' },
  { 层级: 1, 名称: '监院二', 类型: 'position', 负责人: '释xx法师', 父节点: '住持', 排序: 3, 人员: '' },
  { 层级: 1, 名称: '监院三', 类型: 'position', 负责人: '释xx法师', 父节点: '住持', 排序: 4, 人员: '' },
  { 层级: 1, 名称: '监院四', 类型: 'position', 负责人: '释xx法师', 父节点: '住持', 排序: 5, 人员: '' },
  { 层级: 1, 名称: '监院五', 类型: 'position', 负责人: '释xx法师', 父节点: '住持', 排序: 6, 人员: '' },
  { 层级: 1, 名称: '方丈办', 类型: 'department', 负责人: '', 父节点: '住持', 排序: 7, 人员: '' },
  
  // 维那下的部门（第二层）
  { 层级: 2, 名称: '禅堂', 类型: 'department', 负责人: '', 父节点: '维那', 排序: 1, 人员: '' },
  { 层级: 2, 名称: '念佛堂', 类型: 'department', 负责人: '', 父节点: '维那', 排序: 2, 人员: '' },
  { 层级: 2, 名称: '法堂', 类型: 'department', 负责人: '', 父节点: '维那', 排序: 3, 人员: '' },
  
  // 监院一下的部门（第二层）
  { 层级: 2, 名称: '寮元', 类型: 'department', 负责人: '', 父节点: '监院一', 排序: 1, 人员: '' },
  { 层级: 2, 名称: '监修', 类型: 'department', 负责人: '', 父节点: '监院一', 排序: 2, 人员: '' },
  { 层级: 2, 名称: '司库', 类型: 'department', 负责人: '', 父节点: '监院一', 排序: 3, 人员: '' },
  { 层级: 2, 名称: '十方苑', 类型: 'department', 负责人: '', 父节点: '监院一', 排序: 4, 人员: '' },
  { 层级: 2, 名称: '典座', 类型: 'department', 负责人: '', 父节点: '监院一', 排序: 5, 人员: '' },
  { 层级: 2, 名称: '财务', 类型: 'department', 负责人: '', 父节点: '监院一', 排序: 6, 人员: '' },
  
  // 监院二下的部门（第二层）
  { 层级: 2, 名称: '基金会', 类型: 'department', 负责人: '', 父节点: '监院二', 排序: 1, 人员: '' },
  { 层级: 2, 名称: '编辑部', 类型: 'department', 负责人: '', 父节点: '监院二', 排序: 2, 人员: '' },
  { 层级: 2, 名称: '禅茶中心', 类型: 'department', 负责人: '', 父节点: '监院二', 排序: 3, 人员: '' },
  { 层级: 2, 名称: '围棋中心', 类型: 'department', 负责人: '', 父节点: '监院二', 排序: 4, 人员: '' },
  { 层级: 2, 名称: '云林书院', 类型: 'department', 负责人: '', 父节点: '监院二', 排序: 5, 人员: '' },
  { 层级: 2, 名称: '文宣部', 类型: 'department', 负责人: '', 父节点: '监院二', 排序: 6, 人员: '' },
  { 层级: 2, 名称: '培训中心', 类型: 'department', 负责人: '', 父节点: '监院二', 排序: 7, 人员: '' },
  { 层级: 2, 名称: '图书馆', 类型: 'department', 负责人: '', 父节点: '监院二', 排序: 8, 人员: '' },
  { 层级: 2, 名称: '造像艺术中心', 类型: 'department', 负责人: '', 父节点: '监院二', 排序: 9, 人员: '' },
  { 层级: 2, 名称: '非物质文化中心', 类型: 'department', 负责人: '', 父节点: '监院二', 排序: 10, 人员: '' },
  { 层级: 2, 名称: '数字佛典中心', 类型: 'department', 负责人: '', 父节点: '监院二', 排序: 11, 人员: '' },
  
  // 监院三下的部门（第二层）
  { 层级: 2, 名称: '殿堂案', 类型: 'department', 负责人: '', 父节点: '监院三', 排序: 1, 人员: '' },
  { 层级: 2, 名称: '客堂', 类型: 'department', 负责人: '', 父节点: '监院三', 排序: 2, 人员: '' },
  
  // 客堂下的子部门（第三层）
  { 层级: 3, 名称: '人事培训', 类型: 'sub_department', 负责人: '', 父节点: '客堂', 排序: 1, 人员: '张三' },
  { 层级: 3, 名称: '法务', 类型: 'sub_department', 负责人: '', 父节点: '客堂', 排序: 2, 人员: '张三' },
  { 层级: 3, 名称: '行政', 类型: 'sub_department', 负责人: '', 父节点: '客堂', 排序: 3, 人员: '张三' },
  { 层级: 3, 名称: '接待', 类型: 'sub_department', 负责人: '', 父节点: '客堂', 排序: 4, 人员: '张三' },
  
  // 监院四下的部门（第二层）
  { 层级: 2, 名称: '安保部', 类型: 'department', 负责人: '', 父节点: '监院四', 排序: 1, 人员: '' },
  { 层级: 2, 名称: '流通处', 类型: 'department', 负责人: '', 父节点: '监院四', 排序: 2, 人员: '' },
  { 层级: 2, 名称: '僧值', 类型: 'department', 负责人: '', 父节点: '监院四', 排序: 3, 人员: '' },
  
  // 方丈办下的部门（第二层）
  { 层级: 2, 名称: '档案', 类型: 'department', 负责人: '', 父节点: '方丈办', 排序: 1, 人员: '' },
  { 层级: 2, 名称: '医务室', 类型: 'department', 负责人: '', 父节点: '方丈办', 排序: 2, 人员: '' },
];

// 将类型转换为中文显示
function formatType(type: string): string {
  const typeMap: Record<string, string> = {
    'committee': '委员会',
    'position': '职位',
    'department': '部门',
    'sub_department': '子部门'
  };
  return typeMap[type] || type;
}

// 生成Excel文件
function generateExcel() {
  // 创建工作簿
  const workbook = XLSX.utils.book_new();
  
  // 准备数据，将类型转换为中文
  const excelData = organizationData.map(row => ({
    层级: row.层级,
    名称: row.名称,
    类型: formatType(row.类型),
    负责人: row.负责人 || '',
    父节点: row.父节点 || '',
    排序: row.排序,
    人员: row.人员 || ''
  }));
  
  // 创建工作表
  const worksheet = XLSX.utils.json_to_sheet(excelData);
  
  // 设置列宽
  worksheet['!cols'] = [
    { wch: 8 },  // 层级
    { wch: 20 }, // 名称
    { wch: 12 }, // 类型
    { wch: 15 }, // 负责人
    { wch: 15 }, // 父节点
    { wch: 8 },  // 排序
    { wch: 20 }  // 人员
  ];
  
  // 将工作表添加到工作簿
  XLSX.utils.book_append_sheet(workbook, worksheet, '组织架构');
  
  // 保存文件
  const outputPath = path.join(__dirname, '../../organization_structure.xlsx');
  XLSX.writeFile(workbook, outputPath);
  
  console.log('✅ Excel文件生成成功！');
  console.log(`📁 文件路径: ${outputPath}`);
  console.log(`📊 共 ${excelData.length} 条记录`);
}

// 运行生成
generateExcel();

